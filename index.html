<!doctype html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
  <meta name="description" content="Ù…ÙˆÙ‚Ø¹ Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ… - Ù…ÙˆÙ‚Ø¹ Ø¥Ø³Ù„Ø§Ù…ÙŠ Ø´Ø§Ù…Ù„" />
  <title>Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ… | Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</title>
  <link rel="icon" type="image/svg+xml"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸŒ™</text></svg>" />
  <link
    href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Tajawal:wght@300;400;500;700;800&family=Scheherazade+New:wght@400;700&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#fbbf24" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ…" />
  <link rel="apple-touch-icon" href="images/icon-192.png" />
  <script src="https://cdn.tailwindcss.com"></script>


  <script src="js/router.js"></script>
  <script src="js/main.js"></script>
  <script src="js/notifications.js?v=ramadan2"></script>
  <link rel="stylesheet" href="css/style.css?v=darkmode1">
</head>

<body class="bg-ramadan-dark text-white font-tajawal overflow-x-hidden">

  <!-- Nav Placeholder -->
  <div id="nav-placeholder"></div>
  <div id="content-area">




    <!-- Hero -->
    <section id="home" class="relative min-h-screen flex items-center justify-center overflow-hidden pt-20">
      <div class="absolute inset-0 stars opacity-40"></div>
      <div class="absolute inset-0 islamic-pattern opacity-18"></div>
      <div class="crescent" aria-hidden="true">â˜¾</div>

      <div class="container mx-auto px-4 text-center relative z-10">
        <div class="mb-8">
          <span class="hero-pill text-gray-200 text-sm font-medium">
            <i class="fas fa-moon text-ramadan-gold"></i>
            Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…
          </span>
        </div>

        <h1 class="text-4xl md:text-6xl lg:text-7xl font-bold mb-4 font-amiri text-ramadan-gold leading-tight">
          Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ…
        </h1>
        <p class="text-base md:text-lg lg:text-xl text-gray-300 mb-8 max-w-2xl mx-auto leading-relaxed px-4">
          Ø´Ù‡Ø± Ø§Ù„Ù‚Ø±Ø¢Ù† ÙˆØ§Ù„Ø±Ø­Ù…Ø© â€” Ø­ÙŠØ« ØªÙØªØ­ Ø£Ø¨ÙˆØ§Ø¨ Ø§Ù„Ø¬Ù†Ø© ÙˆØªØµÙØ¯ Ø§Ù„Ø´ÙŠØ§Ø·ÙŠÙ†
        </p>

        <div class="hero-card glass-effect">
          <div class="grid grid-cols-1 md:grid-cols-3 items-center gap-4">
            <div class="text-center md:text-left">
              <div class="text-sm text-gray-400 mb-2">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„Ù„Ø¥ÙØ·Ø§Ø±</div>
              <div class="flex gap-2 md:gap-4 items-center justify-center md:justify-start">
                <div>
                  <div class="count-num" id="cntHours">00</div>
                  <div class="text-xs text-gray-400">Ø³Ø§Ø¹Ø©</div>
                </div>
                <div>
                  <div class="count-num" id="cntMinutes">00</div>
                  <div class="text-xs text-gray-400">Ø¯Ù‚ÙŠÙ‚Ø©</div>
                </div>
                <div>
                  <div class="count-num" id="cntSeconds">00</div>
                  <div class="text-xs text-gray-400">Ø«Ø§Ù†ÙŠØ©</div>
                </div>
              </div>
            </div>

            <div class="text-center py-4">
              <div class="flex flex-col sm:flex-row gap-3 justify-center">
                <a href="quran.html"
                  class="px-6 py-2 rounded-full border border-ramadan-gold text-ramadan-gold hover:bg-ramadan-gold/20 transition-all text-sm md:text-base inline-block">
                  Ø§Ù‚Ø±Ø£ Ø§Ù„Ù‚Ø±Ø¢Ù†
                </a>
                <a href="tracker.html"
                  class="px-6 py-2 rounded-full bg-ramadan-gold text-ramadan-dark hover:bg-ramadan-gold-light transition-all text-sm md:text-base inline-block">
                  ØªØªØ¨Ø¹ Ø±Ù…Ø¶Ø§Ù†
                </a>
              </div>
            </div>

            <div class="text-center md:text-right text-gray-400">
              <div class="text-sm mb-1">Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ</div>
              <div class="text-base font-bold text-gray-200" id="hijriDate">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer Placeholder -->
    <!-- Notification Prompt -->
    <div id="notificationPrompt"
      class="fixed bottom-6 right-6 z-50 transform translate-y-20 opacity-0 transition-all duration-500 hidden">
      <div
        class="glass-effect p-4 rounded-2xl border border-ramadan-gold/30 shadow-2xl flex items-center gap-4 max-w-sm">
        <div
          class="w-12 h-12 rounded-full bg-ramadan-gold/20 flex items-center justify-center text-ramadan-gold animate-bounce">
          <i class="fas fa-bell"></i>
        </div>
        <div class="flex-1">
          <p class="text-xs font-bold text-ramadan-gold mb-1">ÙØ¹Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</p>
          <p class="text-[10px] text-gray-300">Ù„ØªØµÙ„Ùƒ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© ÙˆØ§Ù„Ø£Ø°ÙƒØ§Ø± Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</p>
          <button onclick="enableMyNotifications()"
            class="group relative inline-flex items-center gap-3 px-8 py-4 bg-ramadan-gold text-ramadan-dark font-bold text-lg rounded-full hover:bg-white transition-all shadow-[0_0_20px_rgba(251,191,36,0.5)] hover:shadow-[0_0_30px_rgba(251,191,36,0.8)] overflow-hidden">
            <span class="relative z-10"><i class="fas fa-bell ml-2"></i> ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</span>
          </button>
        </div>

      </div>
      <div id="footer-placeholder"></div>

      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
      <script>
        document.addEventListener("DOMContentLoaded", async () => {
          injectNav('home');
          injectFooter();

          // Initialize Timer Display
          document.getElementById("cntHours").textContent = "--";
          document.getElementById("cntMinutes").textContent = "--";
          document.getElementById("cntSeconds").textContent = "--";

          // Initialize Notifications
          if (typeof initNotifications === 'function') {
            const supported = await initNotifications();
            if (supported && Notification.permission === 'default') {
              setTimeout(showNotificationPrompt, 3000);
            }
          }

          // Fetch Prayer Times for Countdown
          fetchPrayerTimesForTimer();

          // Hijri Date Simple Approximation
          const date = new Date();
          const options = { year: 'numeric', month: 'long', day: 'numeric', calendar: 'islamic-umalqura' };
          document.getElementById("hijriDate").textContent = new Intl.DateTimeFormat('ar-SA-u-ca-islamic', options).format(date);
        });

        function showNotificationPrompt() {
          const prompt = document.getElementById('notificationPrompt');
          prompt.classList.remove('hidden');
          setTimeout(() => {
            prompt.classList.remove('translate-y-20', 'opacity-0');
          }, 100);
        }

        function hidePrompt() {
          const prompt = document.getElementById('notificationPrompt');
          prompt.classList.add('translate-y-20', 'opacity-0');
          setTimeout(() => prompt.classList.add('hidden'), 500);
        }

        async function enableMyNotifications() {
          const success = await requestNotificationPermission();
          if (success) {
            hidePrompt();
          }
        }

        let globalMaghribTime = null; // Will hold Date object for today's Maghrib

        async function fetchPrayerTimesForTimer() {
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
              async (position) => {
                const { latitude, longitude } = position.coords;
                await getMaghribTime(latitude, longitude);
              },
              (error) => {
                console.warn("Location access denied", error);
                // Fallback to Cairo
                getMaghribTime(30.0444, 31.2357);
              }
            );
          } else {
            // Fallback to Cairo
            getMaghribTime(30.0444, 31.2357);
          }
        }

        async function getMaghribTime(lat, lng) {
          try {
            const date = new Date();
            const d = date.getDate();
            const m = date.getMonth() + 1;
            const y = date.getFullYear();

            // Egyption Authority
            const url = `https://api.aladhan.com/v1/timings/${d}-${m}-${y}?latitude=${lat}&longitude=${lng}&method=5`;
            const res = await fetch(url);
            const data = await res.json();

            if (data.code === 200) {
              const maghribStr = data.data.timings.Maghrib; // "HH:MM"

              // Parse Time
              const now = new Date();
              const [h, min] = maghribStr.split(':').map(Number);

              const target = new Date();
              target.setHours(h, min, 0, 0);

              // If Maghrib passed today, we ideally want tomorrow's Maghrib, 
              // but for simple "Iftar" timer usually implies next Iftar.
              if (now > target) {
                target.setDate(target.getDate() + 1);
                // Note: Technically should fetch tomorrow's time, but same time is a close enough approx for UI smoothness immediately
              }

              globalMaghribTime = target;

              // Start Timer
              setInterval(updateCountdown, 1000);
              updateCountdown();
            }
          } catch (err) {
            console.error("Timer Fetch Error", err);
          }
        }

        function updateCountdown() {
          if (!globalMaghribTime) return;

          const now = new Date();
          let diff = Math.max(0, globalMaghribTime - now);

          const hrs = Math.floor(diff / (1000 * 60 * 60));
          diff -= hrs * 1000 * 60 * 60;
          const mins = Math.floor(diff / (1000 * 60));
          diff -= mins * 1000 * 60;
          const secs = Math.floor(diff / 1000);

          document.getElementById("cntHours").textContent = String(hrs).padStart(2, "0");
          document.getElementById("cntMinutes").textContent = String(mins).padStart(2, "0");
          document.getElementById("cntSeconds").textContent = String(secs).padStart(2, "0");
        }
      </script>
      <div id="global-player"></div>
</body>

</html>