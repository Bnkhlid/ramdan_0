<!doctype html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>رمضان كريم | الأذكار</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Tajawal:wght@300;400;500;700;800&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="js/main.js?v=persist1"></script>
    <script src="js/share-utils.js"></script>
    <link rel="stylesheet" href="css/style.css?v=persist1">
    
    
</head>

<body class="bg-ramadan-dark text-white font-tajawal">
    <div id="nav-placeholder"></div>
<section id="adhkar" class="py-24 min-h-screen relative overflow-hidden">
        <!-- Background Elements -->
        <div class="absolute inset-0 stars opacity-30"></div>
        <div class="absolute inset-0 islamic-pattern opacity-10"></div>

        <div class="container mx-auto px-4 relative z-10">
            <div class="text-center mb-8">
                <span class="text-ramadan-gold text-sm font-bold tracking-wider">ألا بذكر الله تطمئن القلوب</span>
                <h2 class="text-3xl lg:text-5xl font-bold mt-2 font-amiri text-white">الأذكار اليومية</h2>
            </div>

            <div class="flex flex-col lg:flex-row gap-6 max-w-7xl mx-auto">
                <!-- Categories Sidebar -->
                <div class="lg:w-1/3 glass-effect rounded-2xl h-[50vh] lg:h-[70vh] flex flex-col">
                    <div class="p-4 border-b border-white/10 bg-white/5">
                        <h3 class="font-bold text-ramadan-gold">تصنيفات الأذكار</h3>
                    </div>
                    <div id="categoriesList" class="overflow-y-auto flex-1 p-2 custom-scrollbar space-y-1">
                        <div class="loader mx-auto mt-8"></div>
                    </div>
                </div>

                <!-- Content -->
                <div class="lg:w-2/3 glass-effect rounded-2xl p-4 md:p-8 h-[70vh] flex flex-col relative">
                    <div id="adhkarContent" class="overflow-y-auto flex-1 pr-2 space-y-4 custom-scrollbar">
                        <div class="h-full flex flex-col items-center justify-center text-gray-500">
                            <i class="fas fa-praying-hands text-6xl mb-4 opacity-30"></i>
                            <p>اختر فئة لعرض الأذكار</p>
                        </div>
                    </div>

                    <!-- Floating Counter for current view -->
                    <div id="globalCounter"
                        class="hidden absolute bottom-4 left-4 right-4 bg-ramadan-dark/95 border border-ramadan-gold/30 rounded-xl p-4 shadow-lg backdrop-blur flex justify-between items-center">
                        <span class="text-sm text-gray-400">عداد الجلسة:</span>
                        <span id="sessionCount" class="text-2xl font-bold text-ramadan-gold font-mono">0</span>
                        <button onclick="resetSession()"
                            class="text-xs bg-white/10 px-3 py-1 rounded hover:text-red-400 transition-colors">تصفير</button>
                    </div>
                </div>
            </div>
        </div>
    </section>
<div id="footer-placeholder"></div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            injectNav('adhkar');
            injectFooter();
            loadAdhkar();
        });

        let adhkarData = [];
        let sessionCounter = parseInt(localStorage.getItem('adhkar_session_counter') || '0');
        document.getElementById('sessionCount').textContent = sessionCounter;
        if (sessionCounter > 0) document.getElementById('globalCounter').classList.remove('hidden');

        async function loadAdhkar() {
            try {
                const res = await fetch("data/adkar.json");
                adhkarData = await res.json();
                renderCategories();
            } catch (e) {
                console.error(e);
            }
        }

        function renderCategories() {
            const list = document.getElementById("categoriesList");
            const categories = [...new Set(adhkarData.map(item => item.category))];

            list.innerHTML = '';
            categories.forEach((cat, idx) => {
                const btn = document.createElement("button");
                btn.className = "w-full text-right p-3 rounded-lg hover:bg-white/5 transition-colors text-sm md:text-base flex justify-between items-center group";
                // Shorten text if long
                const display = cat.length > 35 ? cat.substring(0, 35) + "..." : cat;
                const count = adhkarData.filter(a => a.category === cat).length;

                btn.innerHTML = `
                    <span class="group-hover:text-ramadan-gold transition-colors">${display}</span>
                    <span class="text-xs bg-white/10 px-2 py-0.5 rounded-full text-gray-400 group-hover:text-white">${count}</span>
                `;
                btn.onclick = () => showCategory(cat);
                list.appendChild(btn);
            });

            // Auto load first
            if (categories.length > 0) showCategory(categories[0]);
        }

        function showCategory(cat) {
            const container = document.getElementById("adhkarContent");
            container.innerHTML = `<h3 class="text-xl font-bold text-ramadan-gold mb-4 border-b border-white/10 pb-2">${cat}</h3>`;

            const items = adhkarData.filter(a => a.category === cat);
            items.forEach((item, idx) => {
                const div = document.createElement("div");
                div.className = "bg-white/5 rounded-xl p-4 border-r-2 border-ramadan-gold mb-3";
                div.innerHTML = `
                    <p class="text-lg font-amiri leading-loose text-white mb-3" id="text-${item.id}">${item.text}</p>
                    <div class="flex flex-wrap justify-between items-end gap-2">
                        <div class="text-xs text-gray-400 max-w-[60%]">
                             ${item.description ? `<span class="block mb-1 text-ramadan-gold/80">${item.description}</span>` : ''}
                             <span id="source-${item.id}">${item.reference || ''}</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <!-- Share Button -->
                            <button onclick="openShareModal(${item.id})" class="text-gray-400 hover:text-ramadan-gold transition-colors p-2" title="مشاركة">
                                <i class="fas fa-share-alt"></i>
                            </button>
                            
                            <!-- Favorite Button -->
                            <button onclick="toggleAdhkarBookmark(${item.id}, this)" class="text-gray-400 hover:text-red-500 transition-colors p-2" title="إضافة للمفضلة">
                                <i class="${isBookmarked(item.id) ? 'fas fa-heart text-red-500' : 'far fa-heart'}"></i>
                            </button>

                            <button onclick="countItem(this, ${item.count})" class="bg-ramadan-gold text-ramadan-dark font-bold px-4 py-1 rounded-lg hover:bg-white transition-all text-sm shadow-lg flex items-center gap-2">
                                <span>${item.count}</span> <i class="fas fa-repeat text-xs"></i>
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });

            document.getElementById('globalCounter').classList.remove('hidden');
        }

        function countItem(btn, target) {
            // Visual feedback
            const currentText = btn.querySelector('span').textContent;
            let count = parseInt(currentText);

            if (count > 0) {
                count--;
                btn.querySelector('span').textContent = count;
                sessionCounter++;
                document.getElementById('sessionCount').textContent = sessionCounter;
                localStorage.setItem('adhkar_session_counter', sessionCounter);

                if (count === 0) {
                    btn.classList.add('bg-green-500', 'text-white');
                    btn.classList.remove('bg-ramadan-gold', 'text-ramadan-dark');
                    btn.innerHTML = '<i class="fas fa-check"></i>';

                    // Track activity
                    const dhikrText = btn.closest('.bg-white/5').querySelector('p').textContent;
                    const truncatedText = dhikrText.length > 30 ? dhikrText.substring(0, 30) + '...' : dhikrText;
                    addActivity('fas fa-check-circle', `أكملت ذكر: ${truncatedText}`, 'الأذكار');
                }
            }
        }

        function resetSession() {
            sessionCounter = 0;
            document.getElementById('sessionCount').textContent = 0;
            localStorage.setItem('adhkar_session_counter', 0);
        }

        // --- Share & Favorites Logic ---

        function openShareModal(id) {
            const text = document.getElementById(`text-${id}`).innerText;
            const source = document.getElementById(`source-${id}`).innerText;
            showShareOptions(text, source);
        }

        function isBookmarked(id) {
            const bookmarks = JSON.parse(localStorage.getItem('ramadan_bookmarks') || '[]');
            return bookmarks.some(b => b.type === 'adhkar' && b.id === id);
        }

        function toggleAdhkarBookmark(id, btn) {
            let bookmarks = JSON.parse(localStorage.getItem('ramadan_bookmarks') || '[]');
            const index = bookmarks.findIndex(b => b.type === 'adhkar' && b.id === id);
            const icon = btn.querySelector('i');

            if (index > -1) {
                // Remove
                bookmarks.splice(index, 1);
                icon.className = 'far fa-heart';
                icon.classList.remove('text-red-500');
                showToast('تم الحذف من المفضلة');
            } else {
                // Add
                const item = adhkarData.find(a => a.id === id);
                if (item) {
                    bookmarks.push({
                        type: 'adhkar',
                        id: item.id,
                        text: item.text,
                        category: item.category,
                        count: item.count,
                        reference: item.reference || ''
                    });
                    icon.className = 'fas fa-heart text-red-500';
                    showToast('تم الإضافة للمفضلة');
                }
            }
            localStorage.setItem('ramadan_bookmarks', JSON.stringify(bookmarks));
        }

        function showToast(msg) {
            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 1500,
                timerProgressBar: true,
                background: '#0f172a',
                color: '#fff'
            });
            Toast.fire({ icon: 'success', title: msg });
        }
    </script>
</body>

</html>