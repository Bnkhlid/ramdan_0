<!doctype html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>رمضان كريم | التفسير</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Tajawal:wght@300;400;500;700;800&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <script src="https://cdn.tailwindcss.com"></script>
        
    
        <script src="js/main.js"></script>
    <link rel="stylesheet" href="css/style.css?v=darkmode1">
</head>

<body class="bg-ramadan-dark text-white font-tajawal">
    <div id="nav-placeholder"></div>
<section id="tafsir" class="py-24 min-h-screen relative overflow-hidden">
        <div class="absolute inset-0 stars opacity-30"></div>
        <div class="absolute inset-0 islamic-pattern opacity-10"></div>
        <div class="container mx-auto px-4 relative z-10">
            <div class="text-center mb-8">
                <span class="text-ramadan-gold text-sm font-bold tracking-wider">تفسير القرآن الكريم</span>
                <h2 class="text-3xl lg:text-5xl font-bold mt-2 font-amiri text-white">الخلاصة من تفسير الطبري</h2>
            </div>

            <div class="flex flex-col lg:flex-row gap-6 max-w-7xl mx-auto">
                <!-- Sidebar List -->
                <div class="lg:w-1/3 glass-effect rounded-2xl overflow-hidden flex flex-col h-[50vh] lg:h-[70vh]">
                    <div class="p-4 border-b border-ramadan-gold/20 bg-ramadan-gold/10">
                        <span class="font-bold text-ramadan-gold">قائمة التفاسير</span>
                    </div>
                    <div class="overflow-y-auto flex-1 p-2 custom-scrollbar" id="tafsirList">
                        <div class="text-center p-8">
                            <div class="loader mx-auto w-8 h-8"></div>
                            <p class="text-gray-400 mt-4 text-sm">جاري تحميل التفاسير...</p>
                        </div>
                    </div>
                </div>

                <!-- Content Area -->
                <div class="lg:w-2/3 glass-effect rounded-2xl p-6 flex flex-col h-auto relative min-h-[400px]">
                    <h3 class="text-xl font-bold text-ramadan-gold font-amiri mb-4 border-b border-ramadan-gold/20 pb-4"
                        id="currentTafsirName">
                        اختر تفسيراً للاستماع
                    </h3>

                    <div id="tafsirPlayer" class="hidden">
                        <div class="bg-white/5 rounded-xl p-6 mb-6">
                            <div class="flex items-center gap-4">
                                <button id="tafsirRewindBtn"
                                    class="w-10 h-10 rounded-full bg-white/10 text-white hover:bg-white/20 hover:text-ramadan-gold transition-all flex items-center justify-center"
                                    title="إرجاع 5 ثواني">
                                    <i class="fas fa-forward"></i>
                                </button>

                                <button id="tafsirPlayBtn"
                                    class="w-16 h-16 rounded-full bg-ramadan-gold text-ramadan-dark flex items-center justify-center text-2xl hover:bg-white transition-all shadow-lg shadow-ramadan-gold/20">
                                    <i class="fas fa-play" id="tafsirPlayIcon"></i>
                                </button>

                                <button id="tafsirForwardBtn"
                                    class="w-10 h-10 rounded-full bg-white/10 text-white hover:bg-white/20 hover:text-ramadan-gold transition-all flex items-center justify-center"
                                    title="تقديم 5 ثواني">
                                    <i class="fas fa-backward"></i>
                                </button>

                                <div class="flex-1">
                                    <div class="h-2 bg-white/10 rounded-full cursor-pointer relative group"
                                        id="tafsirProgressContainer">
                                        <div id="tafsirProgress" class="h-full bg-ramadan-gold rounded-full relative"
                                            style="width: 0%"></div>
                                    </div>
                                    <div class="flex justify-between text-xs text-gray-400 mt-2">
                                        <span id="tafsirCurrentTime">00:00</span>
                                        <span id="tafsirDuration">00:00</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="text-center p-12">
                            <i class="fas fa-headphones text-6xl text-ramadan-gold/20 mb-6 animate-pulse"></i>
                            <p class="text-gray-300">جاري الاستماع إلى التفسير الصوتي</p>
                        </div>
                    </div>

                    <div id="tafsirPlaceholder" class="flex-1 flex flex-col items-center justify-center text-gray-500">
                        <i class="fas fa-book-reader text-6xl mb-4 opacity-30"></i>
                        <p>اختر سورة من القائمة لعرض تفسيرها الصوتي</p>
                    </div>

                    <audio id="tafsirAudio"></audio>
                </div>
            </div>
        </div>
    </section>
<div id="footer-placeholder"></div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            injectNav('tafsir');
            injectFooter();
            loadTafsir();
        });

        const audio = document.getElementById('tafsirAudio');
        let tafsirData = [];

        async function loadTafsir() {
            try {
                const res = await fetch("data/tafsir.json");
                const json = await res.json();
                tafsirData = json.tafasir?.soar || [];
                renderList();
            } catch (e) {
                document.getElementById('tafsirList').innerHTML = '<p class="p-4 text-red-400 text-center">فشل تحميل البيانات</p>';
                console.error(e);
            }
        }

        function renderList() {
            const list = document.getElementById("tafsirList");
            list.innerHTML = "";
            if (tafsirData.length === 0) {
                list.innerHTML = '<p class="p-4 text-gray-400 text-center">لا توجد بيانات</p>';
                return;
            }
            tafsirData.forEach(item => {
                const div = document.createElement("div");
                div.className = "p-3 rounded-lg hover:bg-white/5 cursor-pointer mb-1 border-b border-white/5 transition-colors flex justify-between items-center group";
                div.onclick = () => playTfsir(item);
                div.innerHTML = `
                    <span class="font-bold group-hover:text-ramadan-gold transition-colors">${item.name}</span>
                    <i class="fas fa-play-circle text-gray-600 group-hover:text-ramadan-gold"></i>
                `;
                list.appendChild(div);
            });
        }

        function playTfsir(item) {
            document.getElementById('currentTafsirName').textContent = item.name;
            document.getElementById('tafsirPlayer').classList.remove('hidden');
            document.getElementById('tafsirPlaceholder').classList.add('hidden');

            audio.src = item.url;
            audio.play();
            updatePlayBtn(true);
        }

        document.getElementById('tafsirPlayBtn').onclick = () => {
            if (audio.paused) { audio.play(); updatePlayBtn(true); }
            else { audio.pause(); updatePlayBtn(false); }
        };

        document.getElementById('tafsirRewindBtn').onclick = () => {
            audio.currentTime = Math.max(0, audio.currentTime - 5);
        };

        document.getElementById('tafsirForwardBtn').onclick = () => {
            audio.currentTime = Math.min(audio.duration || 0, audio.currentTime + 5);
        };

        function updatePlayBtn(isPlaying) {
            const icon = document.getElementById('tafsirPlayIcon');
            if (isPlaying) {
                icon.className = 'fas fa-pause';
            } else {
                icon.className = 'fas fa-play';
            }
        }

        audio.ontimeupdate = () => {
            if (!audio.duration) return;
            const pct = (audio.currentTime / audio.duration) * 100;
            document.getElementById('tafsirProgress').style.width = pct + '%';
            document.getElementById('tafsirCurrentTime').textContent = fmtTime(audio.currentTime);
            document.getElementById('tafsirDuration').textContent = fmtTime(audio.duration);
        };

        audio.onended = () => updatePlayBtn(false);

        function fmtTime(s) {
            if (isNaN(s)) return "00:00";
            const m = Math.floor(s / 60);
            const sec = Math.floor(s % 60);
            return `${m}:${sec.toString().padStart(2, '0')}`;
        }
    </script>
        <div id="global-player"></div>
</body>

</html>